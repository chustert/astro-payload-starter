---
/**
 * Avatar Component (Atom)
 *
 * Displays a user avatar image with optional fallback to initials.
 * Supports various sizes and shapes.
 *
 * @example
 * <Avatar src="/images/person.jpg" alt="John Doe" />
 * <Avatar initials="JD" size="lg" />
 * <Avatar src="/images/person.jpg" alt="John Doe" shape="square" />
 *
 * @customization
 * Override these CSS variables to customize:
 * --avatar-size-{sm|md|lg|xl}, --avatar-border-radius, --avatar-bg
 */

interface Props {
  /** Image source URL */
  src?: string;
  /** Alt text for image */
  alt?: string;
  /** Fallback initials when no image */
  initials?: string;
  /** Avatar size */
  size?: 'sm' | 'md' | 'lg' | 'xl';
  /** Avatar shape */
  shape?: 'circle' | 'square';
  /** Additional CSS classes */
  class?: string;
  [key: string]: any;
}

const {
  src,
  alt = '',
  initials = '',
  size = 'md',
  shape = 'circle',
  class: className = '',
  ...rest
} = Astro.props;

const classes = [
  'avatar',
  `avatar--${size}`,
  `avatar--${shape}`,
  className,
].filter(Boolean).join(' ');

// Generate initials from alt text if not provided
const displayInitials = initials || alt.split(' ').map(word => word[0]).join('').toUpperCase().slice(0, 2);
---

<div class={classes} {...rest}>
  {src ? (
    <img class="avatar__image" src={src} alt={alt} loading="lazy" />
  ) : (
    <span class="avatar__initials">{displayInitials}</span>
  )}
</div>

<style>
  .avatar {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background-color: var(--avatar-bg, var(--color-bg-tertiary));
    color: var(--avatar-color, var(--color-text-secondary));
    font-weight: var(--avatar-font-weight, var(--font-weight-medium));
    flex-shrink: 0;
  }

  /* ============================================
     Size Variants
     ============================================ */

  .avatar--sm {
    width: var(--avatar-size-sm, 2rem);
    height: var(--avatar-size-sm, 2rem);
    font-size: var(--avatar-font-size-sm, var(--text-size-tiny));
  }

  .avatar--md {
    width: var(--avatar-size-md, 2.5rem);
    height: var(--avatar-size-md, 2.5rem);
    font-size: var(--avatar-font-size-md, var(--text-size-small));
  }

  .avatar--lg {
    width: var(--avatar-size-lg, 4rem);
    height: var(--avatar-size-lg, 4rem);
    font-size: var(--avatar-font-size-lg, var(--text-size-medium));
  }

  .avatar--xl {
    width: var(--avatar-size-xl, 6rem);
    height: var(--avatar-size-xl, 6rem);
    font-size: var(--avatar-font-size-xl, var(--text-size-large));
  }

  /* ============================================
     Shape Variants
     ============================================ */

  .avatar--circle {
    border-radius: var(--avatar-border-radius-circle, var(--radius-full));
  }

  .avatar--square {
    border-radius: var(--avatar-border-radius-square, var(--radius-md));
  }

  /* ============================================
     Elements
     ============================================ */

  .avatar__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .avatar__initials {
    text-transform: uppercase;
    user-select: none;
  }
</style>
